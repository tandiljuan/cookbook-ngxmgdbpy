[uwsgi]

# Bind to the specified UNIX/TCP socket using default protocol
<% if @use_tcp -%>
socket                              = <%= @tcp_socket %>
<% else -%>
socket                              = <%= @unix_socket %>
# Change socket permissions so Nginx can talk with uWSGI
chmod-socket                        = 666
<% end -%>

# chdir to specified directory before apps loading
chdir                               = <%= @project_path %>
<% if @use_module -%>
# Load wsgi module
wsgi                                = <%= @project_module %>:<%= @project_entry %>
# Add directory (or glob) to pythonpath
pythonpath                          = <%= File.join(@project_path, @project_module) %>
<% else -%>
# Load .wsgi file
wsgi-file                           = <%= @project_file %>
<% end -%>

# Spawn the specified number of workers/processes
processes                           = <%= @processes %>
# Run each worker in prethreaded mode with the specified number of threads
threads                             = <%= @threads %>

# Make uWSGI exit rather than go into "full dynamic mode"
need-app                            = true
# Load apps in each worker instead of the master
lazy-apps                           = true

# Do not use multiple interpreters (where available)
single-interpreter                  = true

<% if %( development ).include? node.chef_environment -%>
# Monitor python modules mtime to trigger reload (use only in development)
py-autoreload                       = 1
# Do not remap stdin to /dev/null
honour-stdin                        = true
<% end -%>
